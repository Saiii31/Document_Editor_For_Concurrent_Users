<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Editor</title>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.1.2/socket.io.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Static CSS & JS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script defer src="{{ url_for('static', filename='script.js') }}"></script>
    
</head>
<body>
    <!-- Background Image -->
    <!-- <div class="image" style="background-image: url('{{ url_for('static', filename='bg.jpg') }}');"></div> -->

    <!-- Main Editor UI -->
    <div class="container">
        <h1>Document Editor</h1>

        <h3>Edit Document:</h3>
        <form action="/edit" method="POST">
            <label for="user_id">User ID:</label>
            <input type="text" id="user_id" name="user_id" required><br><br>

            <label for="changes">Changes:</label><br>
            <textarea id="changes" name="changes" rows="4" cols="50" required></textarea><br><br>

            <button type="submit">Save Changes</button>
        </form>

        <br><br>
        <h3>Document Data:</h3>
        <div id="document-content">
            {% for key, value in document_data.items() %}
                <p><strong>{{ key }}:</strong> {{ value }}</p>
            {% endfor %}
        </div>
    </div>

    <!-- Alert Box -->
    <div id="alert-box"><p>Changes Saved!</p></div>

    <!-- Socket.IO Script -->
    <script>
        const socket = io();

        socket.on('connect', () => {
            console.log("Connected to WebSocket");
        });

        socket.on('document_update', (data) => {
            const update = typeof data === "string" ? JSON.parse(data) : data;

            const docDiv = document.getElementById("document-content");
            const para = document.createElement("p");
            para.innerHTML = `<strong>${update.user}:</strong> ${update.text}`;
            docDiv.appendChild(para);

            const alertBox = document.getElementById("alert-box");
            alertBox.style.display = 'block';
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 2000);
        });
    </script>
</body>
</html>
